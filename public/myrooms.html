<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>UTD Room Tracker</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/9.19.1/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color:#E87500 ;">
      <a class="navbar-brand" href="index.html">UTD RoomTracker</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <div id="loginNavBarItem"></div>
            <script defer>
              // Display the user's email on their page
              var el = document.getElementById('loginNavBarItem');
              var content = 'Welcome, ' + localStorage.getItem("userEmail");
              el.insertAdjacentHTML('afterbegin', 'Welcome, ' + localStorage.getItem("userEmail"));
          </script>
          </li>
        </ul>
        <span class="navbar-text" style="color: black;">
          Made with ❤️ by Group 14
        </span>
      </div>
    </nav>

    <br/>

    <!-- Main container to hold rooms -->
    <script type="module"> 
        import {unreserveRoom} from "./myrooms.js" 
        window.unreserveRoom = unreserveRoom;
    </script> 
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js';
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = { 
        apiKey: "AIzaSyClWTm6yvT2-ETV_jOYVkiZQLQWzp2iY2s", 
        authDomain: "cs3354-roomtracker.firebaseapp.com",
        projectId: "cs3354-roomtracker",
        storageBucket: "cs3354-roomtracker.appspot.com",
        messagingSenderId: "802621464013",
        appId: "1:802621464013:web:717e234765bd061fddb884"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      import { collection, query, where, getDocs, getFirestore } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
      const db = getFirestore(app);
      const querySnapshot = await getDocs(collection(db, "rooms"));

      var myRooms = 0;

      querySnapshot.forEach((doc) => {
        // Only display non-reserved rooms
        if (doc.data().reservedBy == localStorage.getItem("userUID")) {
          const container = document.getElementById('accordion');

          // Create card element
          const card = document.createElement('div');
          card.classList = 'card-body';
          var idx = doc.id;


          // Construct card content
          const content = `
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">${doc.data().building} ${doc.data().roomNumber}</h5>
              <p class="card-text">Reserved? ${doc.data().reserved}</p>
              <p class="card-text">${doc.data().items}</p>
              <p id="roomIDParagrah" hidden>${doc.id}</p>
            </div>
            <button onclick="unreserveRoom(document.getElementById('roomIDParagrah').innerHTML)" class="btn btn-primary">Unreserve Room</button>
          </div>
          `;

          // Append newyly created card element to the container
          container.innerHTML += content;

          myRooms++;
        }
        });
    

        if (myRooms == 0) {
            const container = document.getElementById('noRooms');

            console.log("I have no rooms");
            const content = `<br>
            <h1 style="text-align:center;">You Have No Rooms Reserved!</h1>
            `;

            container.innerHTML += content;
        }
    </script>
    <div class="container">
      <div class="card-group" id="accordion"></div>
      <div id="noRooms"></div>
    </div>
  </body>
</html>
